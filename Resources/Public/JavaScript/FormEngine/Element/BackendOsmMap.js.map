{"version":3,"sources":["BackendOsmMap.ts"],"names":[],"mappings":"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","file":"BackendOsmMap.js","sourcesContent":["/**\n * This file is developed by evoweb.\n *\n * It is free software; you can redistribute it and/or modify it under\n * the terms of the GNU General Public License, either version 2\n * of the License, or any later version.\n *\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\n\n/// <reference types=\"../types/index\"/>\n\nimport * as $ from 'jquery';\n// @ts-ignore\nimport * as L from 'TYPO3/CMS/StoreFinder/Vendor/Leaflet/leaflet';\n\nclass BackendOsmMap {\n  private map: L.Map;\n  private mapConfiguration: BackendConfiguration = {\n    uid: '0',\n    latitude: 0,\n    longitude: 0,\n    zoom: 15\n  };\n\n  constructor(options: BackendConfiguration) {\n    this.mapConfiguration = options;\n\n    this.initializeMap();\n    this.initializeEvents();\n    this.createMarker();\n    setTimeout(()  => { this.map.invalidateSize(); }, 10);\n  }\n\n  initializeMap(this: BackendOsmMap)\n  {\n    this.map = L.map('map');\n    this.map.setView(\n      [this.mapConfiguration.latitude, this.mapConfiguration.longitude],\n      this.mapConfiguration.zoom\n    );\n\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      maxZoom: 19,\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n    }).addTo(this.map);\n  }\n\n  initializeEvents(this: BackendOsmMap)\n  {\n    $('.t3js-tabmenu-item a').bind('click', (event: JQueryEventObject) => {\n      $('#' + $(event.target).attr('aria-controls')).trigger('cssActiveAdded');\n    });\n\n    $('#map').parents('.tab-pane').on('cssActiveAdded', () => {\n      setTimeout(() => { this.map.invalidateSize(); }, 10);\n    });\n  }\n\n  createMarker(this: BackendOsmMap)\n  {\n    let options = {\n        draggable: true\n      },\n      marker = new L.Marker([this.mapConfiguration.latitude, this.mapConfiguration.longitude], options);\n    marker.bindPopup('').addTo(this.map);\n\n    marker.on('moveend', (event: L.LeafletEvent) => { this.updateCoordinateFields(event.target, this) })\n  }\n\n  updateCoordinateFields(movedMarker: L.Marker, backend: BackendOsmMap)\n  {\n    let coordinates = movedMarker.getLatLng(),\n      fieldPrefix = 'data[tx_storefinder_domain_model_location][' + backend.mapConfiguration.uid + ']',\n      $latitudeField = $('*[data-formengine-input-name=\"' + fieldPrefix + '[latitude]\"]'),\n      $longitudeField = $('*[data-formengine-input-name=\"' + fieldPrefix + '[longitude]\"]');\n\n    $latitudeField.val(coordinates.lat).trigger('change');\n    $longitudeField.val(coordinates.lng).trigger('change');\n  }\n}\n\nexport = BackendOsmMap;\n"]}