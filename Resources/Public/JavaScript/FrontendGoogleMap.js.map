{"version":3,"sources":["FrontendGoogleMap.ts"],"names":[],"mappings":"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","file":"FrontendGoogleMap.js","sourcesContent":["/**\n * This file is developed by evoweb.\n *\n * It is free software; you can redistribute it and/or modify it under\n * the terms of the GNU General Public License, either version 2\n * of the License, or any later version.\n *\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\n\n/// <reference types=\"@types/googlemaps\" />\nimport * as $ from 'jquery';\n\nimport FrontendMap from \"./FrontendMap\";\nimport {Location} from \"./Interfaces\";\n\n/**\n * Module: TYPO3/CMS/StoreFinder/FrontendGoogleMap\n * contains all logic for the frontend map output\n * @exports TYPO3/CMS/StoreFinder/FrontendGoogleMap\n */\nclass FrontendGoogleMap extends FrontendMap {\n  private map: google.maps.Map;\n  private infoWindow: google.maps.InfoWindow;\n\n  /**\n   * Initialize map\n   */\n  initializeMap(this: FrontendGoogleMap) {\n    let center;\n\n    window.google.maps.visualRefresh = true;\n\n    if (typeof this.mapConfiguration.center !== 'undefined') {\n      center = new window.google.maps.LatLng(this.mapConfiguration.center.lat, this.mapConfiguration.center.lng);\n    } else {\n      center = new window.google.maps.LatLng(0, 0);\n    }\n\n    let mapOptions = {\n      zoom: parseInt(this.mapConfiguration.zoom, 10),\n      center: center,\n      disableDefaultUI: true, // a way to quickly hide all controls\n      zoomControl: true,\n      zoomControlOptions: {\n        style: window.google.maps.ZoomControlStyle.LARGE\n      }\n    };\n\n    this.map = new window.google.maps.Map($('#tx_storefinder_map')[0], mapOptions);\n\n    if (this.mapConfiguration.afterSearch === 0 && navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition((position) => {\n        let pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n\n        this.map.setCenter(pos);\n      });\n    }\n  }\n\n  /**\n   * Initialize information layer on map\n   */\n  initializeLayer(this: FrontendGoogleMap) {\n    if (this.mapConfiguration.apiV3Layers.indexOf('traffic') > -1) {\n      let trafficLayer = new window.google.maps.TrafficLayer();\n      trafficLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('bicycling') > -1) {\n      let bicyclingLayer = new window.google.maps.BicyclingLayer();\n      bicyclingLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('panoramio') > -1) {\n      let panoramioLayer = new window.google.maps.panoramio.PanoramioLayer();\n      panoramioLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('weather') > -1) {\n      let weatherLayer = new window.google.maps.weather.WeatherLayer({\n        temperatureUnits: window.google.maps.weather.TemperatureUnit.DEGREE\n      });\n      weatherLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('kml') > -1) {\n      let kmlLayer = new window.google.maps.KmlLayer(this.mapConfiguration.kmlUrl);\n      kmlLayer.setMap(this.map);\n    }\n  }\n\n  /**\n   * Close previously open info window, renders new content and opens the window\n   */\n  showInformation(this: FrontendGoogleMap, location: Location, marker: any) {\n    if (typeof this.mapConfiguration.renderSingleViewCallback === 'function') {\n      this.mapConfiguration.renderSingleViewCallback(location, this.infoWindowTemplate);\n    } else {\n      this.infoWindow.close();\n      this.infoWindow.setContent(this.renderInfoWindowContent(location));\n      this.infoWindow.setPosition(marker.getPosition());\n      this.infoWindow.open(this.map, marker);\n    }\n  }\n\n  /**\n   * Create marker and add to map\n   */\n  createMarker(location: Location, icon: string): google.maps.Marker {\n    let marker = new window.google.maps.Marker({\n      title: location.name,\n      position: new window.google.maps.LatLng(location.lat, location.lng),\n      icon: icon,\n    });\n    marker.setMap(this.map);\n\n    window.google.maps.event.addListener(marker, 'click', () => {\n      this.showInformation(location, marker);\n    });\n\n    return marker;\n  }\n\n  /**\n   * Initialize instance of map infoWindow\n   */\n  initializeInfoWindow(this: FrontendGoogleMap) {\n    this.infoWindow = new window.google.maps.InfoWindow();\n  }\n\n  /**\n   * Close info window\n   */\n  closeInfoWindow() {\n    this.infoWindow.close();\n  }\n\n  /**\n   * Trigger click event on marker on click in result list\n   */\n  openInfoWindow(this: FrontendMap, index: number) {\n    window.google.maps.event.trigger(this.locations[index].marker, 'click');\n  }\n\n  /**\n   * Load google map script\n   */\n  loadScript() {\n    let self = this,\n      apiUrl = 'https://maps.googleapis.com/maps/api/js?v=3.exp',\n      parameter = '&key=' + this.mapConfiguration.apiConsoleKey\n        + '&sensor=' + (this.mapConfiguration.allowSensors ? 'true' : 'false');\n\n    if (self.mapConfiguration.language !== '') {\n      parameter += '&language=' + self.mapConfiguration.language;\n    }\n\n    if (self.mapConfiguration.hasOwnProperty('apiUrl')) {\n      apiUrl = self.mapConfiguration.apiUrl;\n    }\n\n    let $jsDeferred = $.Deferred(),\n      $jsFile = $('<script/>', {\n        src: apiUrl + parameter,\n        crossorigin: ''\n      }).appendTo('head');\n\n    $jsDeferred.resolve($jsFile);\n\n    $.when(\n      $jsDeferred.promise()\n    ).done(function () {\n      function wait(this: FrontendMap) {\n        if (typeof window.google !== 'undefined') {\n          this.postLoadScript();\n        } else {\n          window.requestAnimationFrame(wait.bind(this));\n        }\n      }\n      window.requestAnimationFrame(wait.bind(self));\n    }).fail(function () {\n      console.log('Failed loading resources.');\n    });\n  }\n}\n\n$(document).ready(function () {\n  if (typeof window.mapConfiguration == 'object' && window.mapConfiguration.active) {\n    // make module public to be available for callback after load\n    window.StoreFinder = new FrontendGoogleMap(window.mapConfiguration, window.locations);\n  }\n});\n\n// return constructor\nexport = FrontendGoogleMap;\n"]}