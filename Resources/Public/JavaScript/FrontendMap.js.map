{"version":3,"sources":["FrontendMap.ts"],"names":[],"mappings":"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","file":"FrontendMap.js","sourcesContent":["/**\n * This file is developed by evoweb.\n *\n * It is free software; you can redistribute it and/or modify it under\n * the terms of the GNU General Public License, either version 2\n * of the License, or any later version.\n *\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\n\n/// <reference types=\"@types/googlemaps\" />\nimport * as $ from 'jquery';\n\ninterface MapConfiguration {\n  active: boolean,\n  afterSearch: number;\n  center?: {\n    lat: number,\n    lng: number\n  };\n  zoom?: string;\n\n  apiConsoleKey: string,\n  apiUrl: string,\n  allowSensors: boolean,\n  language: string,\n\n  markerIcon: string,\n  apiV3Layers: string,\n  kmlUrl: string,\n  renderSingleViewCallback(location: object, template: object): void,\n  handleCloseButtonCallback(button: object): void,\n}\n\ninterface Location {\n  name: string,\n  lat: number,\n  lng: number,\n  information: {\n    index: number,\n    icon: string,\n  },\n  marker: object\n}\n\ninterface Marker {\n  sfLocation: Location,\n  getPosition(): Location,\n}\n\ninterface InfoWindow {\n  close(): void,\n  open(map: object, marker: Marker): void,\n  setContent(content: string): void,\n  setPosition(location: Location): void\n}\n\ninterface Template {\n  render(information: object): string\n}\n\ndeclare global {\n  interface Window {\n    google: any;\n    Hogan: any;\n    mapConfiguration: MapConfiguration,\n    locations: Array<Location>\n    StoreFinder: object\n  }\n}\n\n/**\n * Module: TYPO3/CMS/StoreFinder/FrontendMap\n * contains all logic for the frontend map output\n * @exports TYPO3/CMS/StoreFinder/FrontendMap\n */\nclass FrontendMap {\n  private map: google.maps.Map;\n  private mapConfiguration: MapConfiguration;\n  private locations: Array<Location>;\n  private locationIndex: number = 0;\n  private infoWindow: InfoWindow;\n  private infoWindowTemplate: Template;\n\n  /**\n   * The constructor, set the class properties default values\n   */\n  constructor(mapConfiguration: MapConfiguration, locations: Array<Location>) {\n    this.mapConfiguration = mapConfiguration || {\n      active: false,\n      afterSearch: 0,\n\n      apiConsoleKey: '',\n      apiUrl: '',\n      allowSensors: false,\n      language: 'en',\n\n      markerIcon: '',\n      apiV3Layers: '',\n      kmlUrl: '',\n      renderSingleViewCallback: null,\n      handleCloseButtonCallback: null\n    };\n    this.locations = locations;\n\n    this.loadScript();\n  }\n\n  /**\n   * Initialize map\n   */\n  initializeMap(this: FrontendMap) {\n    let center;\n\n    window.google.maps.visualRefresh = true;\n\n    if (typeof this.mapConfiguration.center !== 'undefined') {\n      center = new window.google.maps.LatLng(this.mapConfiguration.center.lat, this.mapConfiguration.center.lng);\n    } else {\n      center = new window.google.maps.LatLng(0, 0);\n    }\n\n    let mapOptions = {\n      zoom: parseInt(this.mapConfiguration.zoom, 10),\n      center: center,\n      disableDefaultUI: true, // a way to quickly hide all controls\n      zoomControl: true,\n      zoomControlOptions: {\n        style: window.google.maps.ZoomControlStyle.LARGE\n      }\n    };\n\n    this.map = new window.google.maps.Map($('#tx_storefinder_map')[0], mapOptions);\n\n    if (this.mapConfiguration.afterSearch === 0 && navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition((position) => {\n        let pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n\n        this.map.setCenter(pos);\n      });\n    }\n  }\n\n  /**\n   * Initialize information layer on map\n   */\n  initializeLayer(this: FrontendMap) {\n    if (this.mapConfiguration.apiV3Layers.indexOf('traffic') > -1) {\n      let trafficLayer = new window.google.maps.TrafficLayer();\n      trafficLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('bicycling') > -1) {\n      let bicyclingLayer = new window.google.maps.BicyclingLayer();\n      bicyclingLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('panoramio') > -1) {\n      let panoramioLayer = new window.google.maps.panoramio.PanoramioLayer();\n      panoramioLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('weather') > -1) {\n      let weatherLayer = new window.google.maps.weather.WeatherLayer({\n        temperatureUnits: window.google.maps.weather.TemperatureUnit.DEGREE\n      });\n      weatherLayer.setMap(this.map);\n    }\n\n    if (this.mapConfiguration.apiV3Layers.indexOf('kml') > -1) {\n      let kmlLayer = new window.google.maps.KmlLayer(this.mapConfiguration.kmlUrl);\n      kmlLayer.setMap(this.map);\n    }\n  }\n\n  /**\n   * Close previously open info window, renders new content and opens the window\n   */\n  showInformation(this: FrontendMap, marker: Marker) {\n    let location = marker.sfLocation;\n\n    if (typeof this.mapConfiguration.renderSingleViewCallback === 'function') {\n      this.mapConfiguration.renderSingleViewCallback(location, this.infoWindowTemplate);\n    } else {\n      this.infoWindow.close();\n      this.infoWindow.setContent(this.infoWindowTemplate.render(location.information));\n      this.infoWindow.setPosition(marker.getPosition());\n      this.infoWindow.open(this.map, marker);\n    }\n  }\n\n  /**\n   * Process single location\n   */\n  processLocation(this: FrontendMap, location: Location) {\n    let markerArguments = {\n        title: location.name,\n        position: new window.google.maps.LatLng(location.lat, location.lng),\n        icon: '',\n      };\n\n    this.locationIndex++;\n    location.information.index = this.locationIndex;\n\n    if (location.information.icon) {\n      markerArguments.icon = location.information.icon;\n    } else if (this.mapConfiguration.hasOwnProperty('markerIcon')) {\n      markerArguments.icon = this.mapConfiguration.markerIcon;\n    }\n\n    let marker = new window.google.maps.Marker(markerArguments);\n    marker.sfLocation = location;\n    marker.setMap(this.map);\n\n    window.google.maps.event.addListener(marker, 'click', (event: Event, marker: Marker): void => {\n      this.showInformation(marker);\n    });\n\n    // attach marker to location to be able to close it later\n    location.marker = marker;\n  }\n\n  /**\n   * Initialize location marker on map\n   */\n  initializeLocations(this: FrontendMap) {\n    this.locations.map(this.processLocation.bind(this));\n  }\n\n  /**\n   * Initialize instance of map infoWindow\n   */\n  initializeInfoWindow(this: FrontendMap) {\n    this.infoWindow = new window.google.maps.InfoWindow();\n  }\n\n  /**\n   * Initialize info window template\n   */\n  initializeTemplates(this: FrontendMap) {\n    this.infoWindowTemplate = window.Hogan.compile($('#templateInfoWindow').html());\n\n    $(document).on('click', '.tx-storefinder .infoWindow .close', (event: Event, $closeButton: JQuery): void => {\n      if (typeof this.mapConfiguration.renderSingleViewCallback === 'function') {\n        this.mapConfiguration.handleCloseButtonCallback($closeButton);\n      } else {\n        this.infoWindow.close();\n      }\n    });\n  }\n\n  /**\n   * Trigger click event on marker on click in result list\n   */\n  openInfoWindow(this: FrontendMap, index: number) {\n    window.google.maps.event.trigger(this.locations[index].marker, 'click');\n  }\n\n  /**\n   * Initialize list click events\n   */\n  initializeListEvents(this: FrontendMap) {\n    $(document).on('click', '.tx-storefinder .resultList > li', (event: Event, $field: JQuery): void => {\n      this.openInfoWindow($field.data('index'));\n    });\n  }\n\n  /**\n   * Post load google map script processing\n   */\n  postLoadScript() {\n    this.initializeMap();\n    this.initializeLayer();\n    this.initializeLocations();\n    this.initializeInfoWindow();\n    this.initializeTemplates();\n    this.initializeListEvents();\n  }\n\n  /**\n   * Load google map script\n   */\n  loadScript() {\n    let self = this,\n      apiUrl = 'https://maps.googleapis.com/maps/api/js?v=3.exp',\n      parameter = '&key=' + this.mapConfiguration.apiConsoleKey\n        + '&sensor=' + (this.mapConfiguration.allowSensors ? 'true' : 'false');\n\n    if (self.mapConfiguration.language !== '') {\n      parameter += '&language=' + self.mapConfiguration.language;\n    }\n\n    if (self.mapConfiguration.hasOwnProperty('apiUrl')) {\n      apiUrl = self.mapConfiguration.apiUrl;\n    }\n\n    $.when(\n      $.getScript(apiUrl + parameter)\n    ).done(function () {\n      function wait(this: FrontendMap) {\n        if (typeof window.google !== 'undefined') {\n          this.postLoadScript();\n        } else {\n          window.requestAnimationFrame(wait.bind(this));\n        }\n      }\n      window.requestAnimationFrame(wait.bind(self));\n    }).fail(function () {\n      console.log('Failed loading google maps resources.');\n    });\n  }\n}\n\n$(document).ready(function () {\n  if (typeof window.mapConfiguration == 'object' && window.mapConfiguration.active) {\n    // make module public to be available for callback after load\n    window.StoreFinder = new FrontendMap(window.mapConfiguration, window.locations);\n  }\n});\n\n// return constructor\nexport = FrontendMap;\n"]}